# DCIM 系统启动说明

## 快速启动

### 方式一：双击启动（推荐）

1. **启动系统**：双击 `start.bat`
   - 系统会自动检查环境、清理端口、启动服务
   - 自动打开浏览器访问系统

2. **停止系统**：双击 `stop.bat`
   - 自动停止所有前后端服务

### 方式二：手动启动

#### 启动后端
```bash
cd backend
python -m uvicorn app.main:app --host 0.0.0.0 --port 8080
```

#### 启动前端
```bash
cd frontend
npm run dev
```

## 访问地址

- **前端**: http://localhost:3000
- **后端**: http://localhost:8080
- **API文档**: http://localhost:8080/docs

## 默认账号

- 账号: `admin`
- 密码: `admin123`

## 启动脚本说明

### start.bat - 主启动脚本
启动时会执行以下步骤：
1. 检查 Python 和 Node.js 环境
2. 清理占用的端口 (8080, 3000, 3001)
3. 检查后端依赖
4. 检查数据库（首次启动会自动初始化）
5. 启动后端服务（端口 8080）
6. 启动前端服务（端口 3000）
7. 自动打开浏览器

### stop.bat - 停止脚本
- 停止所有后端服务（端口 8080）
- 停止所有前端服务（端口 3000, 3001）
- 关闭相关服务窗口

### restart_backend.bat - 重启后端
- 仅重启后端服务，用于开发调试
- 带热重载功能（代码修改后自动重启）

## 端口配置

### 默认端口
- **后端**: 8080
- **前端**: 3000

### 如何修改端口

#### 修改后端端口
1. 编辑 `start.bat`，找到以下行：
   ```batch
   python -m uvicorn app.main:app --host 0.0.0.0 --port 8080
   ```
   将 `8080` 改为你需要的端口

2. 编辑 `frontend/vite.config.ts`，修改 proxy target：
   ```typescript
   proxy: {
     '/api': {
       target: 'http://localhost:8080',  // 改为你的新端口
       changeOrigin: true
     }
   }
   ```

3. 编辑 `frontend/src/utils/request.ts`，修改 backendPort：
   ```typescript
   const backendPort = 8080  // 改为你的新端口
   ```

#### 修改前端端口
编辑 `frontend/vite.config.ts`：
```typescript
server: {
  port: 3000,  // 改为你需要的端口
  ...
}
```

## 常见问题

### 1. 端口被占用
**现象**: 启动失败，提示端口被占用

**解决**:
- 运行 `stop.bat` 清理端口
- 或手动查找占用进程：
  ```bash
  netstat -ano | findstr :8080
  taskkill /F /PID <进程ID>
  ```

### 2. 依赖安装失败
**现象**: 启动时提示缺少模块

**解决**:
```bash
# 后端依赖
cd backend
pip install -r requirements.txt

# 前端依赖
cd frontend
npm install
```

### 3. 数据库初始化失败
**现象**: 后端启动失败，数据库相关错误

**解决**:
```bash
cd backend
# 删除旧数据库
del dcim.db
# 重新启动 start.bat 会自动初始化
```

### 4. 虚拟环境问题
**现象**: 找不到 Python 模块

**解决**:
```bash
cd backend
# 创建虚拟环境
python -m venv .venv
# 激活虚拟环境
.venv\Scripts\activate
# 安装依赖
pip install -r requirements.txt
```

### 5. 前端构建版本启动失败
**现象**: 使用 dist 目录启动时出错

**解决**:
```bash
cd frontend
# 安装 serve 工具
npm install -g serve
# 或者删除 dist 目录使用开发模式
rmdir /s dist
```

## 开发模式 vs 生产模式

### 开发模式（默认）
- 前端：使用 Vite 开发服务器 (`npm run dev`)
- 支持热重载，代码修改后自动更新
- API 通过 Vite proxy 转发到后端

### 生产模式
- 前端：使用构建后的 dist 目录
- 需要先构建：
  ```bash
  cd frontend
  npm run build
  ```
- 性能更好，适合部署

## 更新日志

### v2.0 (最新)
- ✅ 统一端口配置（后端 8080，前端 3000）
- ✅ 自动清理端口冲突
- ✅ 改进启动检查流程
- ✅ 添加彩色界面和进度提示
- ✅ 自动打开浏览器
- ✅ 添加 stop.bat 停止脚本

### v1.0
- 基础启动功能
