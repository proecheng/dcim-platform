# 节能中心系统重新设计方案

> 版本: V1.1
> 日期: 2026-01-26
> 最后更新: 2026-01-27
> 状态: 部分已实施

## 实施状态

| 功能模块 | 状态 | 实施日期 | 备注 |
|---------|------|---------|------|
| 执行管理页面 | ✅ 已完成 | 2026-01-27 | 执行计划列表、详情抽屉、统计卡片 |
| 负荷转移执行流程 | ✅ 已完成 | 2026-01-27 | 配置→创建计划→执行→查看详情闭环 |
| 统计数据计算 | ✅ 已完成 | 2026-01-27 | 预期/实际节省、达成率计算逻辑 |
| 配置恢复功能 | ✅ 已完成 | 2026-01-27 | 从执行管理返回原配置页面 |
| 深色主题优化 | ✅ 已完成 | 2026-01-27 | 统一的科技风深色主题 |
| 机会发现仪表盘 | ⏳ 待实施 | - | 概览卡片、桑基图、机会列表 |
| 交互式模拟器 | ⏳ 待实施 | - | 参数调整、实时预测 |
| 自动控制面板 | ⏳ 待实施 | - | 设备集中控制 |

## 一、设计背景

### 1.1 当前系统痛点

| 痛点 | 描述 |
|------|------|
| 方案太多太杂 | 6种模板×多个措施，用户难以理解和选择 |
| 缺乏行动引导 | 看到建议后不知道具体怎么做，建议和实际操作脱节 |
| 数据分散 | 需量分析、能耗统计、节能建议各自独立，用户需要多页面跳转 |
| 效益不可信 | 年度收益数字看起来像是凑出来的，用户不理解计算逻辑 |

### 1.2 设计目标

- **目标用户**: 多角色（能源管理专家、机房运维人员、管理层/财务）
- **核心定位**: 兼顾智能诊断报告、可执行行动清单、决策支持仪表盘
- **使用路径**: 发现 → 理解 → 决策 → 执行

---

## 二、信息架构总览

```
节能中心 (一级入口)
├── 机会发现仪表盘 (全局视图)
│   ├── 概览卡片 (年度可节省/待处理/执行中/本月已节省)
│   ├── 能源成本流向图 (Sankey)
│   └── 机会优先级列表
│
├── 机会详情 + 模拟器 (单个机会)
│   ├── 左侧: 问题诊断区 (当前状态/问题分析/历史曲线)
│   └── 右侧: 参数模拟器 + 设备选择器
│
├── 执行清单 + 设备控制 (操作界面)
│   ├── 执行任务清单 (自动/手动区分)
│   ├── 自动控制面板 (可控设备集中管理)
│   └── 效果追踪 (预期vs实际)
│
└── 设置
    ├── 电价配置 (完整电费结构)
    └── 设备能力配置
```

---

## 三、第一层：机会发现仪表盘

### 3.1 布局结构

```
┌─────────────────────────────────────────────────────────────┐
│  顶部概览卡片 (4个)                                          │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐       │
│  │ 年度可节省 │ │ 待处理机会 │ │ 执行中任务 │ │ 本月已节省 │       │
│  │ ¥12.6万  │ │   5个    │ │   2个    │ │ ¥8,420  │       │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘       │
├─────────────────────────────────────────────────────────────┤
│  中部：能源成本流向图 (Sankey/桑基图)                          │
│                                                             │
│  总电费 ──┬── 基本电费(需量) ─── 可优化 ¥3.2万               │
│  ¥48万   ├── 电度电费 ─┬─ 尖峰 ─── 可转移 ¥2.1万            │
│          │            ├─ 高峰                              │
│          │            ├─ 平段                              │
│          │            └─ 低谷                              │
│          └── 力调电费 ─── 功率因数偏低 ¥0.8万                │
├─────────────────────────────────────────────────────────────┤
│  底部：节能机会优先级列表                                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 🔴 高 │ 需量申报优化   │ 可节省¥3.2万/年 │ [查看详情]  │   │
│  │ 🟡 中 │ 峰谷时段转移   │ 可节省¥2.1万/年 │ [查看详情]  │   │
│  │ 🟡 中 │ 空调温度优化   │ 可节省¥1.8万/年 │ [查看详情]  │   │
│  │ 🟢 低 │ 设备待机能耗   │ 可节省¥0.6万/年 │ [查看详情]  │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 设计要点

- 概览卡片给管理层看"总账"
- 桑基图直观展示"钱流向哪里"，点击可进入对应优化建议
- 机会列表按优先级排序，运维人员可以按顺序执行

---

## 四、第二层：机会详情 + 交互式模拟器

### 4.1 布局结构（左右分栏）

```
┌────────────────────────────────────────────────────────────────┐
│  面包屑：节能中心 > 需量申报优化                    [返回] [执行] │
├──────────────────────────┬─────────────────────────────────────┤
│  左侧：问题诊断区 (40%)   │  右侧：模拟调整区 (60%)              │
│                          │                                     │
│  ┌──────────────────┐   │  ┌─────────────────────────────┐    │
│  │ 📊 当前状态       │   │  │ 🎛️ 参数调整模拟器            │    │
│  │                  │   │  │                             │    │
│  │ 申报需量: 800kW  │   │  │ 建议申报需量                 │    │
│  │ 实际最大: 612kW  │   │  │ ├────────●────────┤         │    │
│  │ 利用率: 76.5%    │   │  │ 500    650kW    800        │    │
│  │ 月均超额: ¥2,660 │   │  │                             │    │
│  └──────────────────┘   │  │ 安全裕度                     │    │
│                          │  │ ├──●─────────────┤          │    │
│  ┌──────────────────┐   │  │ 5%    10%       20%        │    │
│  │ 🔍 问题分析       │   │  │                             │    │
│  │                  │   │  │ ┌─────────────────────┐    │    │
│  │ • 申报需量偏高    │   │  │ │ 📈 实时收益预测      │    │    │
│  │ • 历史95分位:    │   │  │ │                     │    │    │
│  │   590kW         │   │  │ │ 调整后需量: 650kW   │    │    │
│  │ • 建议降至650kW  │   │  │ │ 年度节省: ¥32,400  │    │    │
│  │ • 风险评估: 低   │   │  │ │ 超需风险: 2.3%     │    │    │
│  └──────────────────┘   │  │ └─────────────────────┘    │    │
│                          │  └─────────────────────────────┘    │
│  ┌──────────────────┐   │                                     │
│  │ 📈 历史需量曲线   │   │  ┌─────────────────────────────┐    │
│  │   (嵌入图表)     │   │  │ 📋 计算公式明细              │    │
│  │   [链接到需量    │   │  │                             │    │
│  │    分析页面]     │   │  │ 年节省 = (800-650) × ¥38   │    │
│  └──────────────────┘   │  │        × 12个月            │    │
│                          │  │      = ¥68,400 (理论)      │    │
│                          │  │      × 0.85 (置信系数)     │    │
│                          │  │      = ¥32,400 (预估)      │    │
│                          │  └─────────────────────────────┘    │
└──────────────────────────┴─────────────────────────────────────┘
```

### 4.2 设计要点

- **左侧静态**：展示诊断结果，让用户理解"为什么有这个机会"
- **右侧动态**：拖动滑块调整参数，实时看到收益变化
- **公式透明**：展示完整计算过程，数据来源清晰，建立信任
- **风险提示**：降低需量有超需风险，需量化展示

---

## 五、设备选择器设计

### 5.1 布局结构

```
┌─────────────────────────────────────────────────────────────────┐
│  🎛️ 参与设备选择                                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 已选: 3/12台设备 │ 可调容量: 43.5kW │ 时段交集: 22:00-06:00 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─ 温度调节 (4台可选) ─────────────────────────────────────┐   │
│  │                                                          │   │
│  │ ☑ 精密空调1    额定50kW   可调15kW   00:00-08:00 ✓自动控制 │   │
│  │   └─ 调节方式: 温度22→26℃, 每1℃降低3kW                   │   │
│  │   └─ 约束: 服务器区温度不得超过28℃                        │   │
│  │                                                          │   │
│  │ ☑ 精密空调2    额定50kW   可调15kW   00:00-08:00 ✓自动控制 │   │
│  │   └─ 调节方式: 温度22→26℃, 每1℃降低3kW                   │   │
│  │                                                          │   │
│  │ ☐ 精密空调3    额定45kW   可调13.5kW 00:00-06:00 ✓自动控制 │   │
│  │   └─ ⚠️ 时段受限: 仅深夜可调                              │   │
│  │                                                          │   │
│  │ ☐ 办公区空调   额定20kW   可调10kW   08:00-18:00 ✗需手动  │   │
│  │   └─ 调节方式: 需人工到现场调整温控器                      │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─ 亮度调节 (2台可选) ─────────────────────────────────────┐   │
│  │                                                          │   │
│  │ ☑ 机房照明     额定5kW    可调2.5kW  22:00-06:00 ✗需硬件  │   │
│  │   └─ 调节方式: 亮度100%→50%, 需调压器                     │   │
│  │   └─ ⚠️ 硬件依赖: 需安装调压装置 (未安装)                  │   │
│  │                                                          │   │
│  │ ☐ 走廊照明     额定2kW    可调1kW    全天可调   ✗需硬件   │   │
│  │   └─ 调节方式: 分区关闭, 需改造配电回路                    │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─ 可调节时段可视化 ────────────────────────────────────────┐   │
│  │     00  02  04  06  08  10  12  14  16  18  20  22  24   │   │
│  │ 空调1 ████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░████████   │   │
│  │ 空调2 ████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░████████   │   │
│  │ 照明  ████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██████   │   │
│  │ ───────────────────────────────────────────────────────  │   │
│  │ 交集  ████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██████   │   │
│  │       (22:00-06:00 共8小时)                              │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
│                              [全选可自动] [清空] [确认选择]      │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 设计要点

- **顶部汇总栏**：实时显示已选设备数、总可调容量、可执行时段交集
- **分组展示**：按调节方式分组（温度、亮度、频率等）
- **设备详情**：每台设备显示额定功率、可调容量、可调时段、是否自动控制
- **约束警告**：⚠️ 标识时段受限、硬件依赖等约束
- **时段可视化**：24小时时间轴，直观显示各设备可调时段和交集

---

## 六、第三层：执行清单 + 设备控制

### 6.1 布局结构

```
┌─────────────────────────────────────────────────────────────────┐
│  执行计划：需量申报优化 + 空调温度调节                            │
│  状态: 待执行                          创建时间: 2026-01-26 14:30 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  📋 执行清单                                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ # │ 操作内容           │ 负责人 │ 方式   │ 状态   │ 操作  │   │
│  ├───┼────────────────────┼────────┼────────┼────────┼───────┤   │
│  │ 1 │ 调整申报需量       │ 电气主管│ 人工   │ ⏳待办 │       │   │
│  │   │ 800kW → 650kW     │        │ 营业厅 │        │       │   │
│  │   │ 📄 下载申请表      │        │        │        │ [完成]│   │
│  ├───┼────────────────────┼────────┼────────┼────────┼───────┤   │
│  │ 2 │ 精密空调1 温度调整  │ -      │ ✓自动  │ ⏳待办 │       │   │
│  │   │ 22℃ → 26℃        │        │        │        │       │   │
│  │   │ 时段: 22:00-06:00 │        │        │        │[立即执行]│  │
│  ├───┼────────────────────┼────────┼────────┼────────┼───────┤   │
│  │ 3 │ 精密空调2 温度调整  │ -      │ ✓自动  │ ⏳待办 │       │   │
│  │   │ 22℃ → 26℃        │        │        │        │       │   │
│  │   │ 时段: 22:00-06:00 │        │        │        │[立即执行]│  │
│  ├───┼────────────────────┼────────┼────────┼────────┼───────┤   │
│  │ 4 │ 机房照明亮度调整    │ 运维员 │ ✗手动  │ ⏳待办 │       │   │
│  │   │ 100% → 50%        │        │ 需调压器│        │       │   │
│  │   │ ⚠️ 需先安装调压装置 │        │        │        │ [完成]│   │
│  └───┴────────────────────┴────────┴────────┴────────┴───────┘   │
│                                                                 │
│  ┌─ 自动控制面板 ────────────────────────────────────────────┐   │
│  │  精密空调1              精密空调2                         │   │
│  │  ┌──────────────┐      ┌──────────────┐                 │   │
│  │  │ 当前温度 22℃ │      │ 当前温度 22℃ │                 │   │
│  │  │ 目标温度 26℃ │      │ 目标温度 26℃ │                 │   │
│  │  │ 执行时段:    │      │ 执行时段:    │                 │   │
│  │  │ 22:00-06:00  │      │ 22:00-06:00  │                 │   │
│  │  │ [▶ 立即执行] │      │ [▶ 立即执行] │                 │   │
│  │  │ [⏰ 定时执行]│      │ [⏰ 定时执行]│                 │   │
│  │  └──────────────┘      └──────────────┘                 │   │
│  │                                                          │   │
│  │  ℹ️ 定时执行将在每天22:00自动调高温度，06:00自动恢复       │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─ 预期效果追踪 ────────────────────────────────────────────┐   │
│  │  预期年节省: ¥32,400        执行进度: 1/4 完成            │   │
│  │  ┌─ 执行后实际效果 (执行7天后可见) ─────────────────────┐ │   │
│  │  │  实际节省: 待统计        达成率: --%                 │ │   │
│  │  │  需量变化: 待下月账单    功率曲线: [查看对比]         │ │   │
│  │  └─────────────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
│                    [导出执行清单PDF] [生成运维工单] [返回]       │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 设计要点

- **执行清单表格**：每个操作项列出内容、负责人、执行方式、状态
- **区分自动/手动**：自动控制的设备有"立即执行"按钮，手动的只能勾选"完成"
- **自动控制面板**：可自动控制的设备集中展示，支持"立即执行"或"定时执行"
- **效果追踪**：预期收益 vs 实际收益对比，执行后持续追踪

---

## 七、电价配置扩展设计

### 7.1 完整电费结构

基于真实工商业电费账单，电价配置需支持以下费用项：

| 费用类别 | 是否可优化 | 优化措施 |
|---------|----------|---------|
| 电度电费 (尖峰/高峰/平段/低谷) | ✓ | 峰谷转移、储能充电 |
| 基本电费 (需量/容量) | ✓ | 需量优化、削峰控制 |
| 功率因数调整电费 | ✓ | 无功补偿 |
| 输配电费 | ✗ | 仅用于成本统计 |
| 政府性基金 | ✗ | 仅用于成本统计 |
| 辅助服务费 | ✗ | 仅用于成本统计 |

### 7.2 配置界面结构

```
┌─────────────────────────────────────────────────────────────────┐
│  电价配置中心                                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  一、电度电费（按kWh计费）                      ← 参与优化       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 时段     │ 时间范围        │ 电价(元/kWh) │ 可优化措施   │   │
│  │ 尖峰    │ 10:00-12:00     │    1.28     │ 峰谷转移    │   │
│  │ 高峰    │ 08-10,14-18     │    1.05     │ 峰谷转移    │   │
│  │ 平段    │ 06-08,12-14,... │    0.68     │ -          │   │
│  │ 低谷    │ 00:00-06:00     │    0.35     │ 储能充电    │   │
│  │ 深谷    │ (部分省份)       │    0.22     │ 储能充电    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  二、基本电费（按kW或kVA计费）                   ← 参与优化       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 计费方式：  ○ 按需量(kW)    ● 按容量(kVA)                │   │
│  │                                                         │   │
│  │ 【需量计费】                                             │   │
│  │ 需量电价:      38.00 元/kW·月                           │   │
│  │ 申报需量:      800 kW                                   │   │
│  │ 超需量加价:    2倍 (超出部分按2倍计费)                    │   │
│  │                                                         │   │
│  │ 【容量计费】(备选)                                        │   │
│  │ 容量电价:      28.00 元/kVA·月                          │   │
│  │ 变压器容量:    1000 kVA                                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  三、功率因数调整电费                           ← 参与优化       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 基准功率因数:  0.90                                      │   │
│  │ 当前功率因数:  0.85                                      │   │
│  │                                                         │   │
│  │ 调整规则:                                                │   │
│  │ • cos φ ≥ 0.95  → 电费减少 0.75%                        │   │
│  │ • cos φ = 0.90  → 不调整                                │   │
│  │ • cos φ ≤ 0.85  → 电费增加 1.5%                         │   │
│  │ • cos φ ≤ 0.80  → 电费增加 3.0%                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  四、其他费用（可配置，不参与优化计算）                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                        参与优化  用于统计 │   │
│  │ 输配电费:      0.15    元/kWh  [可编辑]    ✗       ✓    │   │
│  │ 政府性基金:    0.05    元/kWh  [可编辑]    ✗       ✓    │   │
│  │ 辅助服务费:    0.02    元/kWh  [可编辑]    ✗       ✓    │   │
│  │ 其他附加:      0.00    元/kWh  [可编辑]    ✗       ✓    │   │
│  │                                                         │   │
│  │ ℹ️ 提示：以上费用各省不同，请参照当地电费账单填写。          │   │
│  │    这些费用不影响节能建议的收益计算，但会纳入总成本分析。     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│                                          [保存配置] [恢复默认]   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 八、节能方案分类整合

### 8.1 从6模板简化为4大类

| 新分类 | 整合来源 | 核心目标 | 典型措施 |
|-------|---------|---------|---------|
| 1. 电费结构优化 | A1+A2+A4 | 优化电费账单结构 | 需量优化、峰谷转移、需求响应 |
| 2. 设备运行优化 | A3+A5 | 提高设备效率 | 温度调节、亮度调节、负荷均衡 |
| 3. 设备改造升级 | B1 | 投资改造，长期节能 | 高能效设备更换、变频器加装 |
| 4. 综合能效提升 | 新增 | PUE降低 | 制冷优化、气流组织、余热回收 |

### 8.2 分类详情

**1. 电费结构优化**
- 子措施1: 需量申报优化（降低基本电费）
- 子措施2: 峰谷时段转移（降低电度电费）
- 子措施3: 功率因数补偿（减少力调电费）
- 子措施4: 需求响应参与（获得补贴收益）

**2. 设备运行优化**
- 子措施1: 空调温度优化（温度22℃→26℃）
- 子措施2: 照明亮度优化（亮度100%→70%）
- 子措施3: 设备启停优化（避免空载运行）
- 子措施4: 负荷均衡（错峰启动，降低峰值）

**3. 设备改造升级**
- 子措施1: 老旧空调更换为高能效机型
- 子措施2: LED灯具改造
- 子措施3: 变频器加装
- 投资回收期: 通常2-5年

**4. 综合能效提升**
- 子措施1: 制冷系统优化（冷水机组出水温度）
- 子措施2: 气流组织优化（冷热通道封闭）
- 子措施3: 余热回收（服务器余热用于供暖）
- 子措施4: 自然冷却（冬季室外新风）

---

## 九、数据库设计

### 9.1 新增表

**energy_opportunities (节能机会主表)**

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | INT | 主键 |
| category | INT | 分类: 1-电费结构/2-设备运行/3-设备改造/4-综合能效 |
| title | VARCHAR(200) | 机会标题 |
| priority | ENUM | high/medium/low |
| potential_saving | DECIMAL(12,2) | 年度潜在节省(元) |
| confidence | DECIMAL(3,2) | 置信度(0-1) |
| status | ENUM | discovered/simulating/ready/executing/completed |
| analysis_data | JSON | 分析详情 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

**opportunity_measures (措施表)**

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | INT | 主键 |
| opportunity_id | INT | 外键 |
| measure_type | VARCHAR(50) | demand_adjust/peak_shift/temp_adjust/... |
| regulation_object | VARCHAR(200) | 调节对象 |
| current_state | JSON | 当前参数 |
| target_state | JSON | 目标参数 |
| execution_mode | ENUM | auto/manual/hybrid |
| selected_devices | JSON | 涉及设备列表 |
| calculation_formula | JSON | 计算公式 |
| annual_benefit | DECIMAL(12,2) | 年收益(元) |
| constraints | JSON | 约束条件 |

**execution_plans (执行计划表)**

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | INT | 主键 |
| opportunity_id | INT | 外键 |
| expected_saving | DECIMAL(12,2) | 预期年节省 |
| status | ENUM | pending/executing/completed/failed |
| created_at | DATETIME | 创建时间 |

**execution_tasks (执行任务表)**

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | INT | 主键 |
| plan_id | INT | 外键 |
| task_type | VARCHAR(50) | demand_adjust/device_control/manual_operation |
| target_object | VARCHAR(200) | 设备ID或配置项 |
| execution_mode | ENUM | auto/manual |
| parameters | JSON | 执行参数 |
| status | ENUM | pending/executing/completed/failed |
| assigned_to | VARCHAR(100) | 负责人 |
| executed_at | DATETIME | 执行时间 |
| result | JSON | 执行结果 |

**execution_results (效果追踪表)**

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | INT | 主键 |
| plan_id | INT | 外键 |
| tracking_period | INT | 追踪周期(天) |
| actual_saving | DECIMAL(12,2) | 实际节省(元) |
| achievement_rate | DECIMAL(5,2) | 达成率(%) |
| power_curve_before | JSON | 执行前功率曲线 |
| power_curve_after | JSON | 执行后功率曲线 |
| notes | TEXT | 备注说明 |

### 9.2 扩展现有表

**electricity_pricing 新增字段**

| 字段 | 类型 | 说明 |
|-----|------|-----|
| demand_price | DECIMAL(10,2) | 需量电价 元/kW·月 |
| capacity_price | DECIMAL(10,2) | 容量电价 元/kVA·月 |
| billing_mode | ENUM | demand/capacity |
| over_demand_multiplier | DECIMAL(3,1) | 超需量加价倍数 |
| power_factor_baseline | DECIMAL(3,2) | 功率因数基准 |
| power_factor_rules | JSON | 功率因数调整规则 |
| transmission_fee | DECIMAL(10,4) | 输配电费 |
| government_fund | DECIMAL(10,4) | 政府性基金 |
| auxiliary_fee | DECIMAL(10,4) | 辅助服务费 |

**device_shift_configs 新增字段**

| 字段 | 类型 | 说明 |
|-----|------|-----|
| execution_mode | ENUM | auto/manual/hybrid |
| hardware_dependency | VARCHAR(500) | 硬件依赖说明 |

**load_regulation_configs 新增字段**

| 字段 | 类型 | 说明 |
|-----|------|-----|
| control_interface | ENUM | bms/direct/manual |
| constraints | JSON | 约束条件 |

---

## 十、API接口设计

### 10.1 节能机会管理 API

```
GET  /api/v1/opportunities/dashboard          获取机会仪表盘数据
GET  /api/v1/opportunities/{id}/detail        获取机会详情
POST /api/v1/opportunities/{id}/simulate      模拟参数调整效果
GET  /api/v1/opportunities/{id}/devices       获取可参与设备列表
POST /api/v1/opportunities/{id}/select-devices 选择参与设备
POST /api/v1/opportunities/{id}/execute       确认执行
```

### 10.2 执行管理 API

```
GET  /api/v1/execution/plans/{plan_id}         获取执行计划详情
POST /api/v1/execution/tasks/{task_id}/execute 执行自动任务
POST /api/v1/execution/tasks/{task_id}/complete 完成手动任务
GET  /api/v1/execution/plans/{plan_id}/tracking 获取效果追踪数据
```

### 10.3 电价配置 API

```
GET  /api/v1/pricing/config                    获取完整电价配置
PUT  /api/v1/pricing/config                    更新电价配置
POST /api/v1/pricing/calculate-bill            模拟计算电费
```

---

## 十一、前端组件架构

### 11.1 页面路由

```
/energy-center                                节能中心首页
/energy-center/dashboard                      机会发现仪表盘
/energy-center/opportunity/:id                机会详情+模拟器
/energy-center/execution/:plan_id             执行计划详情
/energy-center/tracking                       效果追踪汇总
/energy-center/settings/pricing               电价配置
/energy-center/settings/devices               设备能力配置
```

### 11.2 核心组件

| 组件 | 说明 |
|------|------|
| EnergyCenterDashboard.vue | 机会仪表盘 |
| SummaryCards.vue | 顶部概览卡片 |
| EnergyCostFlow.vue | 能源成本流向图 (Sankey) |
| OpportunityList.vue | 机会优先级列表 |
| OpportunityDetail.vue | 机会详情页 |
| DiagnosisPanel.vue | 问题诊断面板 |
| ParameterSimulator.vue | 参数调整模拟器 |
| DeviceSelector.vue | 设备选择器 |
| TimeIntersectionChart.vue | 时段交集可视化 |
| ExecutionPlan.vue | 执行计划页 |
| TaskList.vue | 执行任务清单 |
| AutoControlPanel.vue | 自动控制面板 |
| BenefitTracking.vue | 效果追踪面板 |
| PricingConfig.vue | 电价配置页 |

---

## 十二、分阶段实施计划

### Phase 1: 基础架构 (数据层)
- 扩展 electricity_pricing 表
- 扩展设备配置表
- 创建新表结构
- 数据迁移脚本

### Phase 2: 核心服务层
- 电价服务及API
- 重构机会分析引擎
- 模拟计算服务

### Phase 3: 机会管理API
- 完整的机会管理API
- 设备选择服务

### Phase 4: 执行管理
- 执行计划服务
- 设备控制服务
- 执行管理API

### Phase 5: 前端 - 仪表盘与配置
- 状态管理 (stores/energyCenter.ts)
- 节能中心仪表盘页面
- 电价配置页面

### Phase 6: 前端 - 详情与模拟器
- 机会详情页面
- 参数模拟器
- 设备选择器

### Phase 7: 前端 - 执行与追踪
- 执行计划页面
- 效果追踪页面
- 自动控制面板

### Phase 8: 集成测试与上线
- 端到端流程测试
- 文档完善
- 部署上线

---

## 十三、风险与注意事项

### 13.1 技术风险

| 风险 | 应对措施 |
|------|---------|
| 设备控制接口对接 | 先实现模拟控制，逐步对接BMS |
| 效益计算准确性 | 添加置信度指标，持续优化算法 |
| 历史数据迁移 | 做好数据备份，新旧并行运行 |

### 13.2 业务注意事项

| 事项 | 说明 |
|------|------|
| 空调温度调节 | 可直接通过BMS控制，支持自动执行 |
| 灯光亮度调节 | 需要调压装置，标记为硬件依赖 |
| 需量申报调整 | 需到供电局营业厅办理，标记为手动任务 |
| 各省电价差异 | 固定费用允许用户自行配置 |

---

## 附录：术语表

| 术语 | 英文 | 说明 |
|------|------|------|
| 需量 | Demand | 15分钟平均功率最大值 |
| 峰谷平 | Peak-Valley-Normal | 分时电价时段 |
| 功率因数 | Power Factor | 有功功率/视在功率 |
| PUE | Power Usage Effectiveness | 数据中心能效指标 |
| BMS | Building Management System | 楼宇管理系统 |
